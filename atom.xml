<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Anarckk&#39;s Blog</title>
  
  
  <link href="https://anarckk.github.io/myvolantis/atom.xml" rel="self"/>
  
  <link href="https://anarckk.github.io/myvolantis/"/>
  <updated>2023-08-16T13:46:31.741Z</updated>
  <id>https://anarckk.github.io/myvolantis/</id>
  
  <author>
    <name>Anarckk</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>学习数据库的方法</title>
    <link href="https://anarckk.github.io/myvolantis/2023/08/16/2023-08/%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>https://anarckk.github.io/myvolantis/2023/08/16/2023-08/%E5%AD%A6%E4%B9%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2023-08-16T13:42:00.000Z</published>
    <updated>2023-08-16T13:46:31.741Z</updated>
    
    <content type="html"><![CDATA[<p>纸上得来终觉浅，觉知此事要躬行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;纸上得来终觉浅，觉知此事要躬行&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>制作vscode远程容器开发镜像(支持docker和k8s远程容器开发)</title>
    <link href="https://anarckk.github.io/myvolantis/2023/08/15/2023-08/%E5%88%B6%E4%BD%9Cvscode%E8%BF%9C%E7%A8%8B%E5%AE%B9%E5%99%A8%E5%BC%80%E5%8F%91%E9%95%9C%E5%83%8F/"/>
    <id>https://anarckk.github.io/myvolantis/2023/08/15/2023-08/%E5%88%B6%E4%BD%9Cvscode%E8%BF%9C%E7%A8%8B%E5%AE%B9%E5%99%A8%E5%BC%80%E5%8F%91%E9%95%9C%E5%83%8F/</id>
    <published>2023-08-15T02:36:13.000Z</published>
    <updated>2023-08-15T03:58:28.671Z</updated>
    
    <content type="html"><![CDATA[<h2 id="为什么要弄远程容器开发镜像"><a href="#为什么要弄远程容器开发镜像" class="headerlink" title="为什么要弄远程容器开发镜像"></a>为什么要弄远程容器开发镜像</h2><ol><li>越来越少的时间在自己家里搞机，总是东走西走，电脑也不一定用自己的，所以，在一个新地方就重新搭环境，不合理。</li><li>机器多了，可以折腾</li><li>巨硬的vscode太好用了，java，golang, nodejs全部可以在上面开发</li></ol><h2 id="远程开发镜像中有什么"><a href="#远程开发镜像中有什么" class="headerlink" title="远程开发镜像中有什么"></a>远程开发镜像中有什么</h2><p>java开发环境，golang开发环境，nodejs开发环境<br>同时支持docker内嵌docker</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol><li>搭建一个ng服务，提前缓存好jdk等软件，加速构建过程，局域网dns: ng-dev-dependency.bee.anarckk.me</li><li>搭建好verdaccio，这个适合我用，别人不一定需要，局域网dns: verdaccio.bee.anarckk.me</li><li>内网弄好dns解析，软路由上配一下就行</li></ol><h2 id="制作基础镜像fh-dev"><a href="#制作基础镜像fh-dev" class="headerlink" title="制作基础镜像fh-dev"></a>制作基础镜像fh-dev</h2><h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> bee.anarckk.me:<span class="number">5000</span>/anarckk/ubuntu:<span class="number">20.04</span>-git2.<span class="number">24.0</span>-docker20.<span class="number">10.19</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> NG_DEV_DEPENDENCY=ng-dev-dependency.bee.anarckk.me</span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk1.<span class="number">8.0</span>_371</span><br><span class="line"><span class="keyword">ENV</span> MAVEN_HOME /usr/local/apache-maven-<span class="number">3.9</span>.<span class="number">3</span></span><br><span class="line"><span class="keyword">ENV</span> PATH=<span class="string">&quot;$&#123;PATH&#125;:/usr/local/go/bin:/usr/local/node-v18.16.0-linux-x64/bin:$&#123;MAVEN_HOME&#125;/bin:$&#123;JAVA_HOME&#125;/bin:/usr/local/gradle-8.2.1/bin&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> GOPROXY https://proxy.golang.com.cn </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 gradle</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;install gradle&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">cd</span> /usr/local \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; curl -L -O http://<span class="variable">$&#123;NG_DEV_DEPENDENCY&#125;</span>/gradle/gradle-8.2.1-bin.zip \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; unzip gradle-8.2.1-bin.zip \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf gradle-8.2.1-bin.zip \</span></span><br><span class="line"><span class="language-bash">    <span class="comment"># 安装 maven</span></span></span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install maven&#x27;</span> \</span><br><span class="line">    &amp;&amp; cd /usr/local \</span><br><span class="line">    &amp;&amp; curl -L -O http://$&#123;NG_DEV_DEPENDENCY&#125;/apache-maven-<span class="number">3.9</span>.<span class="number">3</span>-bin.tar.gz \</span><br><span class="line">    &amp;&amp; tar xzf apache-maven-<span class="number">3.9</span>.<span class="number">3</span>-bin.tar.gz \</span><br><span class="line">    &amp;&amp; rm -rf apache-maven-<span class="number">3.9</span>.<span class="number">3</span>-bin.tar.gz \</span><br><span class="line">    <span class="comment"># 安装 java8</span></span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install java8&#x27;</span> \</span><br><span class="line">    &amp;&amp; curl -L -O http://$&#123;NG_DEV_DEPENDENCY&#125;/jdk-<span class="number">8</span>u371-linux-x64.tar.gz \</span><br><span class="line">    &amp;&amp; tar zxf jdk-<span class="number">8</span>u371-linux-x64.tar.gz \</span><br><span class="line">    &amp;&amp; rm -rf jdk-<span class="number">8</span>u371-linux-x64.tar.gz \</span><br><span class="line">    <span class="comment"># 安装 java17</span></span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install java17&#x27;</span> \</span><br><span class="line">    &amp;&amp; curl -L -O http://$&#123;NG_DEV_DEPENDENCY&#125;/openjdk-<span class="number">17.0</span>.<span class="number">2</span>_linux-x64_bin.tar.gz \</span><br><span class="line">    &amp;&amp; tar zxf openjdk-<span class="number">17.0</span>.<span class="number">2</span>_linux-x64_bin.tar.gz \</span><br><span class="line">    &amp;&amp; rm -rf openjdk-<span class="number">17.0</span>.<span class="number">2</span>_linux-x64_bin.tar.gz \</span><br><span class="line">    <span class="comment"># 安装 nodejs</span></span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install nodejs&#x27;</span> \</span><br><span class="line">    &amp;&amp; cd /usr/local \</span><br><span class="line">    &amp;&amp; curl -L -O http://$&#123;NG_DEV_DEPENDENCY&#125;/node-v18.<span class="number">16.0</span>-linux-x64.tar.xz \</span><br><span class="line">    &amp;&amp; tar -xvf node-v18.<span class="number">16.0</span>-linux-x64.tar.xz \</span><br><span class="line">    &amp;&amp; rm -rf node-v18.<span class="number">16.0</span>-linux-x64.tar.xz \</span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install npm@^9.7.2&#x27;</span> \</span><br><span class="line">    &amp;&amp; npm install -g npm@^<span class="number">9.7</span>.<span class="number">2</span> \</span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install nrm&#x27;</span> \</span><br><span class="line">    &amp;&amp; npm i -g nrm open@<span class="number">8.4</span>.<span class="number">2</span> --save \</span><br><span class="line">    &amp;&amp; nrm <span class="keyword">add</span><span class="language-bash"> verdaccio http://verdaccio.bee.anarckk.me/ \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; nrm use verdaccio \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;install yarn&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; npm install -g yarn@^1.22.19 \</span></span><br><span class="line"><span class="language-bash">    <span class="comment"># 安装 golang</span></span></span><br><span class="line">    &amp;&amp; echo <span class="string">&#x27;install golang&#x27;</span> \</span><br><span class="line">    &amp;&amp; cd /usr/local \</span><br><span class="line">    &amp;&amp; curl -L -O http://$&#123;NG_DEV_DEPENDENCY&#125;/go1.<span class="number">20.4</span>.linux-amd64.tar.gz \</span><br><span class="line">    &amp;&amp; rm -rf /usr/local/go \</span><br><span class="line">    &amp;&amp; tar -C /usr/local -xzf go1.<span class="number">20.4</span>.linux-amd64.tar.gz \</span><br><span class="line">    &amp;&amp; rm -rf go1.<span class="number">20.4</span>.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [ <span class="string">&quot;/root/.vscode-server&quot;</span>, <span class="string">&quot;/root/.m2&quot;</span>, <span class="string">&quot;/root/.ssh&quot;</span>,<span class="string">&quot;/root/go/pkg&quot;</span>, <span class="string">&quot;/root/go/bin&quot;</span>, <span class="string">&quot;/root/.npm&quot;</span> ] </span></span><br></pre></td></tr></table></figure><h3 id="构建命令"><a href="#构建命令" class="headerlink" title="构建命令"></a>构建命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t bee.anarckk.me:5000/anarckk/fh-dev:latest . \</span><br><span class="line">&amp;&amp; docker push bee.anarckk.me:5000/anarckk/fh-dev:latest</span><br></pre></td></tr></table></figure><h3 id="已推送到dockerhub上"><a href="#已推送到dockerhub上" class="headerlink" title="已推送到dockerhub上"></a>已推送到dockerhub上</h3><p><a href="https://hub.docker.com/repository/docker/anarckk/fh-dev">https://hub.docker.com/repository/docker/anarckk/fh-dev</a></p><h2 id="在基础镜像上制作业务镜像"><a href="#在基础镜像上制作业务镜像" class="headerlink" title="在基础镜像上制作业务镜像"></a>在基础镜像上制作业务镜像</h2><h3 id="dockerfile-1"><a href="#dockerfile-1" class="headerlink" title="dockerfile"></a>dockerfile</h3><p>业务镜像主要在基础镜像上增加自定义maven配置，自定义golang的私有依赖仓库配置</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> bee.anarckk.me:<span class="number">5000</span>/anarckk/fh-dev:latest</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> GIT_NAME=michael</span><br><span class="line"><span class="keyword">ARG</span> GIT_EMAIL=michael@gmail.com</span><br><span class="line"><span class="comment"># mavne的配置文件</span></span><br><span class="line"><span class="keyword">ARG</span> MVN_SETTINGS=settings.xml</span><br><span class="line"><span class="keyword">ENV</span> GOINSECURE gogs.bee.anarckk.me</span><br><span class="line"><span class="keyword">ENV</span> GONOPROXY gogs.bee.anarckk.me</span><br><span class="line"><span class="keyword">ENV</span> GONOSUMDB gogs.bee.anarckk.me</span><br><span class="line"><span class="keyword">ENV</span> GOPRIVATE gogs.bee.anarckk.me</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git config --global user.name <span class="variable">$GIT_NAME</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; git config --global user.email <span class="variable">$GIT_EMAIL</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">ln</span> -s /usr/bin/python3 /usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$&#123;MVN_SETTINGS&#125;</span> /usr/local/apache-maven-3.9.3/conf/settings.xml</span></span><br></pre></td></tr></table></figure><h3 id="构建命令-1"><a href="#构建命令-1" class="headerlink" title="构建命令"></a>构建命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build --no-cache -t bee.anarckk.me:5000/anarckk/my-dev2:latest \</span><br><span class="line">  --build-arg GIT_NAME=anarckk \</span><br><span class="line">  --build-arg GIT_EMAIL=anarckk@gmail.com \</span><br><span class="line">  --build-arg MVN_SETTINGS=settings.xml . \</span><br><span class="line">&amp;&amp; docker push bee.anarckk.me:5000/anarckk/my-dev2:latest</span><br></pre></td></tr></table></figure><h3 id="docker-compose-yaml运行脚本"><a href="#docker-compose-yaml运行脚本" class="headerlink" title="docker-compose.yaml运行脚本"></a>docker-compose.yaml运行脚本</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">my-dev2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bee.anarckk.me:5000/anarckk/my-dev2:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">my-dev2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">custom-bridge:</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/workdir/data2/dev/my-dev/workspace:/workdir/data2/dev/my-dev/workspace</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./vscode-server:/root/.vscode-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../common/m2:/root/.m2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../common/ssh:/root/.ssh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../common/pkg:/root/go/pkg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../common/go-bin:/root/go/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../common/npm-cache:/root/.npm</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">max-size:</span> <span class="string">&quot;10m&quot;</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">custom-bridge:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="同时，这个镜像那个可以k8s远程容器开发"><a href="#同时，这个镜像那个可以k8s远程容器开发" class="headerlink" title="同时，这个镜像那个可以k8s远程容器开发"></a>同时，这个镜像那个可以k8s远程容器开发</h2><p>这个技术学会的太晚了，早一年学会这个技术，就不用telepresence折腾的麻烦，远程到容器中开发，对于调试k8s二开的应用来说，方便的很。</p><p>k8s1-dev.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s1-dev-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">finalizers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubernetes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">k8s1-dev</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s1-dev</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">k8s1-dev-ns</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s1-dev</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">k8s1-dev-ns</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">k8s1-dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">k8s1-dev</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bee.anarckk.me:5000/anarckk/my-dev2:latest</span></span><br><span class="line">    <span class="attr">stdin:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/workdir/data1/k8s1-dev/workspace</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">workspace</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/.vscode-server</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">vscode-server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/go/pkg</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">go-pkg</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/go/bin</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">go-bin</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/.ssh</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">ssh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/.kube</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">kube</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">3Gi</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">500Mi</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">k8s1</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">workspace</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/workspace</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vscode-server</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/common/vscode-server</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">go-pkg</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/common/go-pkg</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">go-bin</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/common/go-bin</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ssh</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/common/ssh</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/workdir/data1/k8s1-dev/common/.kube</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">  <span class="comment">#- name: docker</span></span><br><span class="line">  <span class="comment">#  hostPath:</span></span><br><span class="line">  <span class="comment">#    path: /var/lib/docker</span></span><br><span class="line">  <span class="attr">serviceAccountName:</span> <span class="string">k8s1-dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s1-dev-admin</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s1-dev</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">k8s1-dev-ns</span></span><br></pre></td></tr></table></figure><p>运行这个脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f k8s1-dev.yaml</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;为什么要弄远程容器开发镜像&quot;&gt;&lt;a href=&quot;#为什么要弄远程容器开发镜像&quot; class=&quot;headerlink&quot; title=&quot;为什么要弄远程容器开发镜像&quot;&gt;&lt;/a&gt;为什么要弄远程容器开发镜像&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;越来越少的时间在自己家里搞机，总是东走西</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>重新恢复搭建hexo的过程</title>
    <link href="https://anarckk.github.io/myvolantis/2023/06/20/2023-6/%E6%90%AD%E5%BB%BAhexo%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
    <id>https://anarckk.github.io/myvolantis/2023/06/20/2023-6/%E6%90%AD%E5%BB%BAhexo%E7%9A%84%E8%BF%87%E7%A8%8B/</id>
    <published>2023-06-20T01:21:54.000Z</published>
    <updated>2023-06-20T09:09:51.787Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>以前hexo像是在玩一样，只是随便弄一弄。自从私有云服务器没了，就再没搞过hexo博客.</p><p>但是现在发现 material-x 已经变成了 volantis 升级更新的很好，所以这次想放到github page上做永久发布。</p><p><a href="https://zhuanlan.zhihu.com/p/603658639">知乎 - hexo-butterfly主题-giscus评论系统设置</a><br><a href="https://zhuanlan.zhihu.com/p/392900543">知乎 - 【hexo】基础教程-四-新增RSS订阅</a>  </p><p><a href="https://giscus.app/zh-CN">giscus</a>  </p><h2 id="增加rss订阅"><a href="#增加rss订阅" class="headerlink" title="增加rss订阅"></a>增加rss订阅</h2><p>运行：<code>npm install --save hexo-generator-feed</code></p><p>然后修改文件 _config.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="string">hexo-generator-feed</span></span><br><span class="line"><span class="comment">#Feed Atom</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>然后就可以了，<code>npm run build</code>完了之后，就可以用了。</p><p>参考: <a href="https://zhuanlan.zhihu.com/p/392900543">知乎 - 【hexo】基础教程-四-新增RSS订阅</a>  </p><h2 id="开启搜索服务"><a href="#开启搜索服务" class="headerlink" title="开启搜索服务"></a>开启搜索服务</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################### Search ############################### &gt; start</span></span><br><span class="line"><span class="comment"># To use hexo search, you need to install the following plugins:</span></span><br><span class="line"><span class="comment"># npm i hexo-generator-json-content</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">hexo</span>  <span class="comment"># hexo</span></span><br><span class="line">  <span class="attr">js:</span></span><br><span class="line"><span class="comment">############################### Search ############################### &gt; end</span></span><br></pre></td></tr></table></figure><p>根据这个配置来，在 _config.volantis.yml ，先执行命令，再放一下这个配置，就OK了</p><h2 id="配置giscus评论系统"><a href="#配置giscus评论系统" class="headerlink" title="配置giscus评论系统"></a>配置giscus评论系统</h2><p>_config.volantis.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############################################################################################</span></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">giscus</span></span><br><span class="line">  <span class="comment"># giscus</span></span><br><span class="line">  <span class="comment"># https://giscus.app</span></span><br><span class="line">  <span class="comment"># https://github.com/laymonage/giscus</span></span><br><span class="line">  <span class="attr">giscus:</span></span><br><span class="line">    <span class="comment"># 以下配置按照 yml 格式增删填写即可</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">anarckk/giscus</span></span><br><span class="line">    <span class="attr">repo-id:</span> <span class="string">R_kgDOJxkH0w</span></span><br><span class="line">    <span class="attr">category:</span> <span class="string">Announcements</span></span><br><span class="line">    <span class="attr">category-id:</span> <span class="string">DIC_kwDOJxkH084CXU85</span></span><br><span class="line">    <span class="attr">mapping:</span> <span class="string">&quot;url&quot;</span></span><br><span class="line">    <span class="attr">reactions-enabled:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="attr">emit-metadata:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">lang:</span> <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line">    <span class="comment"># 以上配置按照 yml 格式增删填写即可</span></span><br><span class="line">    <span class="attr">theme:</span></span><br><span class="line">      <span class="attr">light:</span> <span class="string">&quot;light&quot;</span> <span class="comment"># https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@master/css/giscus/light.css</span></span><br><span class="line">      <span class="attr">dark:</span> <span class="string">&quot;dark&quot;</span> <span class="comment"># https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@master/css/giscus/dark.css</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################################################################</span></span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://zhuanlan.zhihu.com/p/603658639">知乎 - hexo-butterfly主题-giscus评论系统设置</a>  </p><p><a href="https://giscus.app/zh-CN">giscus</a>  </p><h2 id="增加用户配置"><a href="#增加用户配置" class="headerlink" title="增加用户配置"></a>增加用户配置</h2><p>参考资料：<a href="https://volantis.js.org/v5/advanced-settings/?keyword=author">https://volantis.js.org/v5/advanced-settings/?keyword=author</a></p><p>增加文件 source&#x2F;_data&#x2F;author.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Anarckk:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Anarckk</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">https://cn.bing.com/th?id=AMMS_fc8f99fd41ebd737a71c4e13806db9a0&amp;w=110&amp;h=110&amp;c=7&amp;rs=1&amp;qlt=80&amp;pcl=f9f9f9&amp;cdv=1&amp;dpr=2&amp;pid=16.1</span></span><br><span class="line">  <span class="attr">url:</span> </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;以前hexo像是在玩一样，只是随便弄一弄。自从私有云服务器没了，就再没搞过hexo博客.&lt;/p&gt;
&lt;p&gt;但是现在发现 material-x </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>解决excel文件下载乱码问题</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/15/2020-1/15-%E8%A7%A3%E5%86%B3excel%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/15/2020-1/15-%E8%A7%A3%E5%86%B3excel%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/</id>
    <published>2020-01-15T08:38:39.000Z</published>
    <updated>2023-06-20T07:44:54.795Z</updated>
    
    <content type="html"><![CDATA[<p>　　今天遇到一个excel下载乱码问题，从服务器上使用流下载方式，用jquery.ajax下载之后，再转成blob使用虚拟节点下载客户端。然后一直乱码。找了很多方法，包括服务器指定 response.setCharacterEncoding(“utf-8”); 客户端再使用 charset&#x3D;utf-8 指定编码。再或者从 ms-excel 到修改为 octet-stream ，各种组合都无效。烦了一下午。终于找到了一篇博客 <a href="https://www.jb51.net/article/88972.htm">jQuery的ajax下载blob文件</a> ，很显然这篇博客被抄来抄去。也就不转载了，自己搜吧以后。这篇博客提供了一个思路，ajax在底层自动将数据转型为字符串，而且编码不被控制。这也就是为什么我自己制定编码都无效的原因，因为我没有指定ajax底层的编码方式。</p><span id="more"></span><p><strong>旧代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: method,</span><br><span class="line">    data: JSON.stringify(data),</span><br><span class="line">    url: <span class="string">&quot;http://localhost:8096&quot;</span> + url,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).done(function (data, status, jqXHR) &#123;</span><br><span class="line">    console.log(data <span class="keyword">instanceof</span> Blob);</span><br><span class="line">    <span class="type">var</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.readAsText(<span class="keyword">new</span> <span class="title class_">Blob</span>([data]), <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    reader.onload = function (evt) &#123;</span><br><span class="line">        console.log(evt);</span><br><span class="line">        <span class="type">const</span> <span class="variable">url</span> <span class="operator">=</span> window.URL.createObjectURL(<span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&#x27;\uFEFF&#x27;</span> + evt.target.result], &#123;type: <span class="string">&#x27;application/ms-excel;charset=utf-8&#x27;</span>&#125;));</span><br><span class="line">        <span class="type">const</span> <span class="variable">link</span> <span class="operator">=</span> document.createElement(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        link.href = url;</span><br><span class="line">        link.setAttribute(<span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;名片印刷导出.xls&#x27;</span>);</span><br><span class="line">        document.body.appendChild(link);</span><br><span class="line">        link.click();</span><br><span class="line">        URL.revokeObjectURL(link.href);</span><br><span class="line">        document.body.removeChild(link);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>　　本着这个思路，就用 XMLHttpRequest 替代掉了 ajax ，没想到马上就解决了。真的是坑</p><p><strong>有效的代码</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;/businessCard/excelBusinessCard&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> method = <span class="string">&quot;POST&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">    <span class="string">&quot;applicantId&quot;</span>: <span class="title function_">getUserId</span>(),</span><br><span class="line">    <span class="string">&quot;pageNo&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;pageSize&quot;</span>: <span class="number">10000</span></span><br><span class="line">&#125;;</span><br><span class="line">data.<span class="property">token</span> = <span class="title function_">getToken</span>();</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>,  <span class="string">&quot;http://localhost:8096&quot;</span> + url, <span class="literal">true</span>);    <span class="comment">// 也可以使用POST方式，根据接口</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line">xhr.<span class="property">responseType</span> = <span class="string">&quot;blob&quot;</span>;  <span class="comment">// 返回类型blob</span></span><br><span class="line"><span class="comment">// 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 请求完成</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 返回200</span></span><br><span class="line">        <span class="keyword">var</span> blob = <span class="variable language_">this</span>.<span class="property">response</span>;</span><br><span class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">        reader.<span class="title function_">readAsDataURL</span>(blob);  <span class="comment">// 转换为base64，可以直接放入a表情href</span></span><br><span class="line">        reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="comment">// 转换完成，创建一个a标签用于下载</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            a.<span class="property">download</span> = <span class="string">&#x27;data.xls&#x27;</span>;</span><br><span class="line">            a.<span class="property">href</span> = e.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">            $(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(a);  <span class="comment">// 修复firefox中无法触发click</span></span><br><span class="line">            a.<span class="title function_">click</span>();</span><br><span class="line">            $(a).<span class="title function_">remove</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 发送ajax请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;　　今天遇到一个excel下载乱码问题，从服务器上使用流下载方式，用jquery.ajax下载之后，再转成blob使用虚拟节点下载客户端。然后一直乱码。找了很多方法，包括服务器指定 response.setCharacterEncoding(“utf-8”); 客户端再使用 charset&amp;#x3D;utf-8 指定编码。再或者从 ms-excel 到修改为 octet-stream ，各种组合都无效。烦了一下午。终于找到了一篇博客 &lt;a href=&quot;https://www.jb51.net/article/88972.htm&quot;&gt;jQuery的ajax下载blob文件&lt;/a&gt; ，很显然这篇博客被抄来抄去。也就不转载了，自己搜吧以后。这篇博客提供了一个思路，ajax在底层自动将数据转型为字符串，而且编码不被控制。这也就是为什么我自己制定编码都无效的原因，因为我没有指定ajax底层的编码方式。&lt;/p&gt;</summary>
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="excel" scheme="https://anarckk.github.io/myvolantis/tags/excel/"/>
    
  </entry>
  
  <entry>
    <title>Character类检查码点一个char放不放的下</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/10/2020-1/10-Character%E7%B1%BB%E6%A3%80%E6%9F%A5%E7%A0%81%E7%82%B9%E4%B8%80%E4%B8%AAchar%E6%94%BE%E4%B8%8D%E6%94%BE%E7%9A%84%E4%B8%8B/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/10/2020-1/10-Character%E7%B1%BB%E6%A3%80%E6%9F%A5%E7%A0%81%E7%82%B9%E4%B8%80%E4%B8%AAchar%E6%94%BE%E4%B8%8D%E6%94%BE%E7%9A%84%E4%B8%8B/</id>
    <published>2020-01-10T01:02:26.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>　　在java中，一个char是2个字节，用utf-16进行编码。一个字符可以转为数字，我猜称为码点(codePoint)。Character里有个方法可以检查，一个码点要用几个char来放。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果一个字符用utf-8编码，那么它就有3个字节。</span></span><br><span class="line"><span class="comment"> * 这个函数检查，2个字节能不能放的下codePoint码点的字符</span></span><br><span class="line"><span class="comment"> * 放的下返回1，放不下返回2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">charCount</span><span class="params">(<span class="type">int</span> codePoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> codePoint &gt;= MIN_SUPPLEMENTARY_CODE_POINT ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;　　在java中，一个char是2个字节，用utf-16进行编码。一个字符可以转为数字，我猜称为码点(codePoint)。Character里有个方法可以检查，一个码点要用几个char来放。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;tabl</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>java 依赖、组合、聚合与继承</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-java-%E4%BE%9D%E8%B5%96%E3%80%81%E7%BB%84%E5%90%88%E3%80%81%E8%81%9A%E5%90%88%E4%B8%8E%E7%BB%A7%E6%89%BF/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-java-%E4%BE%9D%E8%B5%96%E3%80%81%E7%BB%84%E5%90%88%E3%80%81%E8%81%9A%E5%90%88%E4%B8%8E%E7%BB%A7%E6%89%BF/</id>
    <published>2020-01-09T05:20:36.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>类之间的关系大体上存在五种—继承(实现)、依赖、关联、聚合、组合。</p><h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>继承是一种“is-a”关系。多了就不说了，都懂得。</p><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p>依赖简单的理解，就是一个类A中的方法使用到了另一个类B。</p><p>这种使用关系是具有偶然性的、临时性的、非常弱的，但是B类的变化会影响到A。</p><p>比如说，我用笔写字，首先需要一个类来代表我自己，然后需要一个类来代表一支笔，最后，‘我’要调用‘笔’里的方法来写字，用代码实现一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pen</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;use pen to write&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Me</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(Pen pen)</span>&#123;<span class="comment">//这里，pen作为Me类方法的参数。  Me类依赖Pen类</span></span><br><span class="line">        pen.write();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看到这大家都懂了，因为这种代码你每天都会写。现在你知道了，这就是一种类与类之间的关系，叫做依赖。</p><p>这种关系是一种很弱的关系，但是pen类的改变，有可能会影响到Me类的结果，比如我把pen类write方法的方法体改了，me中再调用就会得到不同的结果。</p><p><strong>一般而言，依赖关系在Java中体现为局域变量、方法的形参，或者对静态方法的调用。</strong></p><h4 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h4><p>关联体现的是两个类、或者类与接口之间语义级别的一种强依赖关系。</p><p>这种关系比依赖更强、不存在依赖关系的偶然性、关系也不是临时性的，一般是长期性的，而且双方的关系一般是平等的、关联可以是单向、双向的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pen 还是上面的pen</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">You</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Pen pen; <span class="comment">// 让pen成为you的类属性 </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">You</span><span class="params">(Pen p)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.pen = p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span>&#123;</span><br><span class="line">        pen.write();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>被关联类B以类属性的形式出现在关联类A中，或者关联类A引用了一个类型为被关联类B的全局变量的这种关系，就叫关联关系。</p><p><strong>在Java中，关联关系一般使用成员变量来实现。</strong></p><h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4><p>聚合是关联关系的一种特例，他体现的是整体与部分、拥有的关系，即has-a的关系</p><p>看下面一段代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Family</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Child&gt; children; <span class="comment">//一个家庭里有许多孩子</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在代码层面，聚合和关联关系是一致的，只能从语义级别来区分。普通的关联关系中，a类和b类没有必然的联系，而聚合中，需要b类是a类的一部分，是一种”has-a“的关系，即 a has-a b; 比如家庭有孩子，屋子里有空调。</p><p>但是，has 不是 must has，a可以有b，也可以没有。a是整体，b是部分，整体与部分之间是可分离的，他们可以具有各自的生命周期，部分可以属于多个整体对象，也可以为多个整体对象共享。</p><p><strong>不同于关联关系的平等地位，聚合关系中两个类的地位是不平等。</strong></p><h4 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h4><p>组合也是关联关系的一种特例，他体现的是一种contains-a的关系，这种关系比聚合更强，也称为强聚合。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Eye</span> <span class="variable">eye</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Eye</span>();  <span class="comment">//一个人有鼻子有眼睛</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Nose</span> <span class="variable">nose</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Nose</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>组合同样体现整体与部分间的关系，但此时整体与部分是不可分的，整体的生命周期结束也就意味着部分的生命周期结束。</p><p>就像你有鼻子有眼睛，如果你一不小心结束了生命周期，鼻子和眼睛的生命周期也会结束，而且，鼻子和眼睛不能脱离你单独存在。</p><p>只看代码，你是无法区分关联，聚合和组合的，具体是哪一种关系，只能从语义级别来区分。</p><p><strong>同样，组合关系中，两个类关系也是不平等的。</strong></p><h4 id="组合，聚合和继承"><a href="#组合，聚合和继承" class="headerlink" title="组合，聚合和继承"></a>组合，聚合和继承</h4><p>依赖关系是每一个java程序都离不开的，所以就不单独讨论了，普通的关联关系也没有什么特殊的地方，下面我们重点研究一下组合，聚合和继承。</p><h5 id="聚合与组合"><a href="#聚合与组合" class="headerlink" title="聚合与组合"></a>聚合与组合</h5><p>聚合与组合都是一种关联关系，只是额外具有整体-部分的意义。</p><p>部件的生命周期不同</p><p>聚合关系中，整件不会拥有部件的生命周期，所以整件删除时，部件不会被删除。再者，多个整件可以共享同一个部件。</p><p>组合关系中，整件拥有部件的生命周期，所以整件删除时，部件一定会跟着删除。而且，多个整件不可以同时间共享同一个部件。</p><p><strong>这个区别可以用来区分某个关联关系到底是组合还是聚合。两个类生命周期不同步，则是聚合关系，生命周期同步就是组合关系。</strong></p><p>聚合关系是【has-a】关系，组合关系是【contains-a】关系</p><p>平时我们只讨论组合和继承的时候，认为组合是【has-a 】关系，而事实上，聚合才是真正的【has-a】关系，组合是更深层次的【contains-a】关系。</p><p>由于【contains-a】关系是一种更深的【has-a】关系，所以说组合是【has-a】关系也是正确的。</p><h5 id="组合和继承"><a href="#组合和继承" class="headerlink" title="组合和继承"></a>组合和继承</h5><p>这个才是本文的重点。</p><p>学过设计模式的都知道，要“少用继承，多用组合”，这究竟是为什么呢？</p><p>我们先来看一下组合和继承各自的优缺点：</p><p><strong>组合</strong></p><p>优点：</p><ul><li>不破坏封装，整体类与局部类之间松耦合，彼此相对独立</li><li>具有较好的可扩展性</li><li>支持动态组合。在运行时，整体对象可以选择不同类型的局部对象</li><li>整体类可以对局部类进行包装，封装局部类的接口，提供新的接口</li></ul><p>缺点：</p><ul><li>整体类不能自动获得和局部类同样的接口</li><li>创建整体类的对象时，需要创建所有局部类的对象</li></ul><p><strong>继承</strong></p><p>优点:</p><ul><li>子类能自动继承父类的接口</li><li>创建子类的对象时，无须创建父类的对象</li></ul><p>缺点：</p><ul><li>破坏封装，子类与父类之间紧密耦合，子类依赖于父类的实现，子类缺乏独立性</li><li>支持扩展，但是往往以增加系统结构的复杂度为代价</li><li>不支持动态继承。在运行时，子类无法选择不同的父类</li><li>子类不能改变父类的接口</li></ul><p>(后面罗里吧嗦的，不记了)</p><h4 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h4><p><a href="https://www.cnblogs.com/ccgjava/p/11433745.html">https://www.cnblogs.com/ccgjava/p/11433745.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;类之间的关系大体上存在五种—继承(实现)、依赖、关联、聚合、组合。&lt;/p&gt;
&lt;h4 id=&quot;继承&quot;&gt;&lt;a href=&quot;#继承&quot; class=&quot;headerlink&quot; title=&quot;继承&quot;&gt;&lt;/a&gt;继承&lt;/h4&gt;&lt;p&gt;继承是一种“is-a”关系。多了就不说了，都懂得。&lt;/p&gt;</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>shiro的组件架构</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/09/%E5%BD%92%E6%A1%A3/shiro/2020-01-09-shiro%E7%9A%84%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/09/%E5%BD%92%E6%A1%A3/shiro/2020-01-09-shiro%E7%9A%84%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84/</id>
    <published>2020-01-09T03:29:50.000Z</published>
    <updated>2023-06-19T08:37:14.701Z</updated>
    
    <content type="html"><![CDATA[<p>Shiro主要组件包括：Subject，SecurityManager，Authenticator，Authorizer，SessionManager，CacheManager，Cryptography，Realms。</p><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>Subject表示与系统交互的对象，可以是登录系统的操作用户，也可能是另外一个软件系统。<br>Subject类图：</p><img  src=http://www.plantuml.com/plantuml/svg/ZP1DJWCn38NtdC8xfelc24ZbPy6AYYAnzcJSZ6b8eiG59E00d8H3iE0sS0sI3fGPpIpgXVNq_Fd5Ia2zGKFWer4OKBUaKilHgxIjxqWBF1z1BdP2SOsQO3NmIrrrXY5PHdQQ0zfgjf_klJDlRUROkm6QUcpjlILqm6b9yPv5gAbMaaa3eHWfvUqntcAwpkeFZLbVDkI4rqpn7t_mt83rXbsrs4fR08tbdXk_8GTI-WoaZVunmP2uUD8KYfWujKVcSxldNdTTMqm9picIoIdE_7vTRtPBzNZSBH_30hu_th_UFk5qPqoneDJB2VHp3q0cW-RpJ8ti7m00><h3 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h3><p>SecurityManager是Shiro架构最核心的组件。实际上，SecurityManager就是Shiro框架的控制器，协调其他组件一起完成认证和授权，如下图所示：</p><img  src=http://www.plantuml.com/plantuml/svg/VOx13OCm34NlcS8Ba1qw09Ts0jSoITf28fCS07Lt0aX5WXGV_zVxVW7fZOR1Yz4Oa2phtZhnkZKH9WNvN1TP6YI61rCI5uSQkyo8-ghm3-_JyyLKcDZoArGOF-q9l2_f5OOfsl64tNBgnOshxS4VV5NzX4hTzhFKxBCp>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Shiro主要组件包括：Subject，SecurityManager，Authenticator，Authorizer，SessionManager，CacheManager，Cryptography，Realms。&lt;/p&gt;
&lt;h3 id=&quot;Subject&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="shiro" scheme="https://anarckk.github.io/myvolantis/tags/shiro/"/>
    
  </entry>
  
  <entry>
    <title>在hexo中使用PlantUML来画UML</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-%E5%9C%A8hexo%E4%B8%AD%E4%BD%BF%E7%94%A8PlantUML%E6%9D%A5%E7%94%BBUML/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-%E5%9C%A8hexo%E4%B8%AD%E4%BD%BF%E7%94%A8PlantUML%E6%9D%A5%E7%94%BBUML/</id>
    <published>2020-01-09T03:20:28.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>　　<a href="https://plantuml.com/">PlantUML</a>使你轻松地从文字描述来生成UML，可谓UML中的MarkDown，支持时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等UML以及非UML图。在hexo中可以使用hexo-tag-plantuml插件来集成进来。这种方式画UML不仅快速和可控，还给后期维护带来了便捷性。</p><h4 id="java包"><a href="#java包" class="headerlink" title="java包"></a>java包</h4><p>　　它可以用java直接使用，下载jar包：<a href="https://sourceforge.net/projects/plantuml/files/plantuml.jar/download">plantuml.jar</a>。</p><p>　　描述文件demo.txt:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">start</span><br><span class="line">:配置Java环境; </span><br><span class="line">:下载pantuml.jar;</span><br><span class="line">:编写描述文件; </span><br><span class="line">:执行; </span><br><span class="line">stop</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><p>　　执行Jar</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar plantuml.jar demo.txt</span><br></pre></td></tr></table></figure><h4 id="hexo-plantuml插件"><a href="#hexo-plantuml插件" class="headerlink" title="hexo plantuml插件"></a>hexo plantuml插件</h4><p>安装插件</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-tag-plantuml --save</span><br></pre></td></tr></table></figure><p>语法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% plantuml %&#125;</span><br><span class="line">    Bob-&gt;Alice : hello</span><br><span class="line">&#123;% endplantuml %&#125;</span><br></pre></td></tr></table></figure><img  src=http://www.plantuml.com/plantuml/svg/SyfFqhLppCbCJbMmKiX8pSd91m00><p>示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% plantuml %&#125;</span><br><span class="line">start</span><br><span class="line">:配置Java环境; </span><br><span class="line">:下载pantuml.jar;</span><br><span class="line">:编写描述文件; </span><br><span class="line">:执行; </span><br><span class="line">stop</span><br><span class="line">&#123;% endplantuml %&#125;</span><br></pre></td></tr></table></figure><p>效果如下：</p><img  src=http://www.plantuml.com/plantuml/svg/Aov9B2hXidhPsljyxpglnBB4vtthdovgjbRWidgoe_l5thq5YNabfRavUbc9HTPSLi_tJ7lQDlDPV_-B_HkUJMj_idiRIEMppkKl5lO0MSKb-GK0><h4 id="画图方法"><a href="#画图方法" class="headerlink" title="画图方法"></a>画图方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">继承（泛化）       --|&gt;</span><br><span class="line">接口继承           ..|&gt;</span><br><span class="line">接口实现           ..|&gt;</span><br><span class="line">依赖               ..&gt;</span><br><span class="line">关联               -</span><br><span class="line">直接关联           --&gt;</span><br><span class="line">聚合               o--</span><br><span class="line">组合               *--</span><br></pre></td></tr></table></figure><p>这篇教程已经写的很清楚了。如果以后没有不能用，就不会写它。<a href="https://plantuml.com/zh/class-diagram">https://plantuml.com/zh/class-diagram</a></p><p>还有这张图可以参考</p><p><img src="/myvolantis/assets/images/2020-01/09-UML%E7%AC%A6%E5%8F%B7.jpg" class="lazyload" data-srcset="/myvolantis/assets/images/2020-01/09-UML%E7%AC%A6%E5%8F%B7.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h4><p>PlantUml画类图 <a href="https://www.jianshu.com/p/b65e8dca999d">https://www.jianshu.com/p/b65e8dca999d</a><br><a href="http://www.zhaiqianfeng.com/2017/05/hexo-plantuml.html">http://www.zhaiqianfeng.com/2017/05/hexo-plantuml.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;　　&lt;a href=&quot;https://plantuml.com/&quot;&gt;PlantUML&lt;/a&gt;使你轻松地从文字描述来生成UML，可谓UML中的MarkDown，支持时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等UML以及非UML图。在hexo中可以使用hexo</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="uml" scheme="https://anarckk.github.io/myvolantis/tags/uml/"/>
    
  </entry>
  
  <entry>
    <title>String.trim()</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-String-trim/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-String-trim/</id>
    <published>2020-01-09T00:52:36.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>函数签名</p><blockquote><p>public String trim();</p></blockquote><p>注释</p><blockquote><p>Returns a string whose value is this string, with any leading and trailing whitespace removed.<br>返回一个字符串它的值是它自身，移除前导和后缀空白字符</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;函数签名&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;public String trim();&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;注释&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Returns a string whose value is this string, w</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
    <category term="java api" scheme="https://anarckk.github.io/myvolantis/tags/java-api/"/>
    
  </entry>
  
  <entry>
    <title>给类制作标准文档</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-%E7%BB%99%E7%B1%BB%E5%88%B6%E4%BD%9C%E6%A0%87%E5%87%86%E6%96%87%E6%A1%A3/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/09/2020-1/09-%E7%BB%99%E7%B1%BB%E5%88%B6%E4%BD%9C%E6%A0%87%E5%87%86%E6%96%87%E6%A1%A3/</id>
    <published>2020-01-09T00:36:05.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>现在发现，java学习更多是api接口学习。所以要学会把懂的接口写成文档。一个类，所在包，内部公开的api,api调用示例，讲解。这些都要有个标准。就这么定吧：只记录自己见到用到的api的用法，以及源码的英文翻译。和自己的见解。不做全面细致的api翻译，不去全面搞懂所有的api。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;现在发现，java学习更多是api接口学习。所以要学会把懂的接口写成文档。一个类，所在包，内部公开的api,api调用示例，讲解。这些都要有个标准。就这么定吧：只记录自己见到用到的api的用法，以及源码的英文翻译。和自己的见解。不做全面细致的api翻译，不去全面搞懂所有的a</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>shiro认证过程</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/08/%E5%BD%92%E6%A1%A3/shiro/2020-01-08-shiro%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/08/%E5%BD%92%E6%A1%A3/shiro/2020-01-08-shiro%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/</id>
    <published>2020-01-08T08:58:09.000Z</published>
    <updated>2023-06-19T08:37:14.701Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Subject</span> <span class="variable">currentUser</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line"><span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(username, password);</span><br><span class="line">token.setRememberMe(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">　　currentUser.login(token);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">　　logger.error(String.format(<span class="string">&quot;user not found: %s&quot;</span>, username), e); <span class="comment">// 用户不存在</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">　　logger.error(String.format(<span class="string">&quot;incorrent credentials: %s&quot;</span>, username), e); <span class="comment">// 密码不正确</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ConcurrentAccessException e) &#123;</span><br><span class="line">　　logger.error(String.format(<span class="string">&quot;user has been authenticated: %s&quot;</span>, username), e); <span class="comment">// 用户重复登录</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (AccountException e) &#123;</span><br><span class="line">　　logger.error(String.format(<span class="string">&quot;account except: %s&quot;</span>, username), e); <span class="comment">// 其他账户异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="shiro" scheme="https://anarckk.github.io/myvolantis/tags/shiro/"/>
    
  </entry>
  
  <entry>
    <title>springboot访问命令行参数</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/08/2020-1/08-springboot%E8%AE%BF%E9%97%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/08/2020-1/08-springboot%E8%AE%BF%E9%97%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/</id>
    <published>2020-01-08T01:52:06.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>默认情况下，SpringApplication 将所有命令行选项参数（即以 – 开头的参数，比如 –server.port&#x3D;9000）转换为属性，并将它们添加到 Spring Environment 中。如之前所述，命令行属性始终优先于其他属性源。</p><p>如果您不希望将命令行属性添加到 Environment，可以使用 SpringApplication.setAddCommandLineProperties(false) 来禁用它们。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;默认情况下，SpringApplication 将所有命令行选项参数（即以 – 开头的参数，比如 –server.port&amp;#x3D;9000）转换为属性，并将它们添加到 Spring Environment 中。如之前所述，命令行属性始终优先于其他属性源。&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="SpringBoot" scheme="https://anarckk.github.io/myvolantis/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>mybatis按时间段搜索</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/07/2020-1/07-mybatis%E6%8C%89%E6%97%B6%E9%97%B4%E6%AE%B5%E6%90%9C%E7%B4%A2/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/07/2020-1/07-mybatis%E6%8C%89%E6%97%B6%E9%97%B4%E6%AE%B5%E6%90%9C%E7%B4%A2/</id>
    <published>2020-01-07T01:37:33.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> vacate <span class="keyword">WHERE</span> create_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2020-1-1 00:00:00&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2020-1-7 09:18:00&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="mybatis-mapper"><a href="#mybatis-mapper" class="headerlink" title="mybatis mapper"></a>mybatis mapper</h3><p><img src="/myvolantis/assets/images/2020-01/07-mybatis%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6.jpg" class="lazyload" data-srcset="/myvolantis/assets/images/2020-01/07-mybatis%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;submitFrom != null and submitTo != null&quot;</span>&gt;</span></span><br><span class="line">  and create_time between #&#123;submitFrom&#125; and #&#123;submitTo&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--或者如下--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startTime != null&quot;</span>&gt;</span></span><br><span class="line">    AND create_time <span class="symbol">&amp;gt;</span>= #&#123;startTime,jdbcType=TIMESTAMP&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endTime != null&quot;</span>&gt;</span></span><br><span class="line">    AND create_time <span class="symbol">&amp;lt;</span>= #&#123;endTime,jdbcType=TIMESTAMP&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;mysql&quot;&gt;&lt;a href=&quot;#mysql&quot; class=&quot;headerlink&quot; title=&quot;mysql&quot;&gt;&lt;/a&gt;mysql&lt;/h3&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="mybatis" scheme="https://anarckk.github.io/myvolantis/tags/mybatis/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 使用 ON UPDATE CURRENT_TIMESTAMP 自动更新 timestamp</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/06/2020-1/06-MySQL-%E4%BD%BF%E7%94%A8-ON-UPDATE-CURRENT-TIMESTAMP-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0-timestamp/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/06/2020-1/06-MySQL-%E4%BD%BF%E7%94%A8-ON-UPDATE-CURRENT-TIMESTAMP-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0-timestamp/</id>
    <published>2020-01-06T04:59:53.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`create_time` timestamp not null default current_timestamp comment &#x27;创建时间&#x27;,</span><br><span class="line">`update_time` timestamp not null default current_timestamp on update current_timestamp comment &#x27;修改时间&#x27;,</span><br></pre></td></tr></table></figure><p>当执行update操作是，并且字段有ON UPDATE CURRENT_TIMESTAMP属性。则字段无论值有没有变化，它的值也会跟着更新为当前UPDATE操作时的时间。</p><p>timestamp的两个属性：CURRENT_TIMESTAMP 和ON UPDATE CURRENT_TIMESTAMP</p><ol><li>CURRENT_TIMESTAMP</li></ol><p>当要向数据库执行insert操作时，如果有个timestamp字段属性设为 CURRENT_TIMESTAMP，则无论这个字段有没有set值都插入当前系统时间  </p><ol start="2"><li>ON UPDATE CURRENT_TIMESTAMP<br>当执行update操作是，并且字段有ON UPDATE CURRENT_TIMESTAMP属性。则字段无论值有没有变化，它的值也会跟着更新为当前UPDATE操作时的时间。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="mysql" scheme="https://anarckk.github.io/myvolantis/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>永久激活idea2019.3</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/04/2020-1/04-%E6%B0%B8%E4%B9%85%E6%BF%80%E6%B4%BBidea2019-3/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/04/2020-1/04-%E6%B0%B8%E4%B9%85%E6%BF%80%E6%B4%BBidea2019-3/</id>
    <published>2020-01-04T07:17:47.000Z</published>
    <updated>2023-06-20T09:15:19.127Z</updated>
    
    <content type="html"><![CDATA[<p>　　今天突然idea不能用了，激活码无法有效激活了。看了下，原来的激活码是用在idea2019.2.3的,我升级了idea的版本到2019.3了。所以激活码不能用应该很正常。重新找了个激活的方法，以下是步骤：</p><h4 id="下载jetbrains-agent-jar"><a href="#下载jetbrains-agent-jar" class="headerlink" title="下载jetbrains-agent.jar"></a>下载jetbrains-agent.jar</h4><p><a href="https://ngpublic.anarckk.love:32443/public-static/myblog/files/2020-1/4-jetbrains-agent.jar" download="jetbrains-agent.jar">jetbrains-agent.jar</a></p><h4 id="移动jetbrains-agent-jar到安装目录"><a href="#移动jetbrains-agent-jar到安装目录" class="headerlink" title="移动jetbrains-agent.jar到安装目录"></a>移动jetbrains-agent.jar到安装目录</h4><p>　　将文件移动到 C:\Program Files\JetBrains\IntelliJ IDEA 2019.2.3\bin 路径下，这是我idea的安装目录。</p><h4 id="修改idea64-exe-vmoptions启动配置"><a href="#修改idea64-exe-vmoptions启动配置" class="headerlink" title="修改idea64.exe.vmoptions启动配置"></a>修改idea64.exe.vmoptions启动配置</h4><p>　　本来按照网上的文章，修改 C:\Program Files\JetBrains\IntelliJ IDEA 2019.2.3\bin\idea64.exe.vmoptions 文件就好，但是我修改了不生效，想起来之前一次有用到idea修改内存大小配置的，配置在这里一样不生效，狡兔三窟的配置文件竟然配置在 C:\Program Files\JetBrains\IntelliJ IDEA 2019.2.3\bin\idea.bat,里面有一段配置是这么写的:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IF NOT EXIST &quot;%VM_OPTIONS_FILE%&quot; (</span><br><span class="line">  :: user-overridden</span><br><span class="line">  SET VM_OPTIONS_FILE=%USERPROFILE%\.IntelliJIdea2019.3\config\idea%BITS%.exe.vmoptions</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>所以，实际的配置文件目录在 C:\Users&lt;!–swig￼3–&gt;.IntelliJIdea2019.3\config\idea64.exe.vmoptions。在末尾添加 -javaagent:破解补丁所在的目录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:D:\IntelliJ IDEA 2019.2.3\bin\jetbrains-agent.jar</span><br></pre></td></tr></table></figure><h4 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h4><p>C:\Windows\System32\drivers\etc\hosts，在末尾补上</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#idea用</span><br><span class="line">0.0.0.0 account.jetbrains.com</span><br><span class="line">0.0.0.0 www.jetbrains.com</span><br></pre></td></tr></table></figure><h4 id="激活idea"><a href="#激活idea" class="headerlink" title="激活idea"></a>激活idea</h4><p>点击Help→Register，选择License Server激活，输入 <a href="http://jetbrains-license-server/">http://jetbrains-license-server</a> ,然后点击Activate，我这张图已经激活完了，激活的时候好像还有个continue按钮。注意不要点exit。</p><style>img {    border-radius: 0 !important;}</style><p><img src="/myvolantis/assets/images/2020-01/04-%E6%BF%80%E6%B4%BBidea.jpg" class="lazyload" data-srcset="/myvolantis/assets/images/2020-01/04-%E6%BF%80%E6%B4%BBidea.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;　　今天突然idea不能用了，激活码无法有效激活了。看了下，原来的激活码是用在idea2019.2.3的,我升级了idea的版本到2019.3了。所以激活码不能用应该很正常。重新找了个激活的方法，以下是步骤：&lt;/p&gt;
&lt;h4 id=&quot;下载jetbrains-agent-ja</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="idea" scheme="https://anarckk.github.io/myvolantis/tags/idea/"/>
    
    <category term="idea激活" scheme="https://anarckk.github.io/myvolantis/tags/idea%E6%BF%80%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>visio中用手型工具拖动设计界面</title>
    <link href="https://anarckk.github.io/myvolantis/2020/01/02/2020-1/02-visio%E4%B8%AD%E7%94%A8%E6%89%8B%E5%9E%8B%E5%B7%A5%E5%85%B7%E6%8B%96%E5%8A%A8%E8%AE%BE%E8%AE%A1%E7%95%8C%E9%9D%A2/"/>
    <id>https://anarckk.github.io/myvolantis/2020/01/02/2020-1/02-visio%E4%B8%AD%E7%94%A8%E6%89%8B%E5%9E%8B%E5%B7%A5%E5%85%B7%E6%8B%96%E5%8A%A8%E8%AE%BE%E8%AE%A1%E7%95%8C%E9%9D%A2/</id>
    <published>2020-01-02T13:50:23.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>Ctrl + Alt + 左键放大 &#x2F; 右键拖动</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Ctrl + Alt + 左键放大 &amp;#x2F; 右键拖动&lt;/p&gt;
</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="visio" scheme="https://anarckk.github.io/myvolantis/tags/visio/"/>
    
  </entry>
  
  <entry>
    <title>接口的传统风格转向RestFul风格</title>
    <link href="https://anarckk.github.io/myvolantis/2019/12/31/%E5%BD%92%E6%A1%A3/restful/2019-12-31-%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BC%A0%E7%BB%9F%E9%A3%8E%E6%A0%BC%E8%BD%AC%E5%90%91RestFul%E9%A3%8E%E6%A0%BC/"/>
    <id>https://anarckk.github.io/myvolantis/2019/12/31/%E5%BD%92%E6%A1%A3/restful/2019-12-31-%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BC%A0%E7%BB%9F%E9%A3%8E%E6%A0%BC%E8%BD%AC%E5%90%91RestFul%E9%A3%8E%E6%A0%BC/</id>
    <published>2019-12-31T04:04:29.000Z</published>
    <updated>2023-06-19T08:37:14.701Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/myvolantis/assets/images/2019-12/31-restful%E9%A3%8E%E6%A0%BC.jpg" class="lazyload" data-srcset="/myvolantis/assets/images/2019-12/31-restful%E9%A3%8E%E6%A0%BC.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>想到以前的点赞接口，如果用restful改，应该改成 &#x2F;topic&#x2F;{topicId}&#x2F;my&#x2F;zan&#x2F;{status} 。status表示我对这个topic表示赞还是不赞。</p><p>查询其他用户是否点了赞用 &#x2F;topic&#x2F;{topicId}&#x2F;{userId}&#x2F;zan</p><p>账户零钱增加x元的接口，哎，设计不出来的接口就不要抱着教条主义了，改一下，继续用 post &#x2F;account&#x2F;addMoney 也不会死。对于很难设计的动作类接口，如果可以想一个抽象名字代表就更好。不然就回归传统。</p><h4 id="对于抽象动词都表达不了的意思"><a href="#对于抽象动词都表达不了的意思" class="headerlink" title="对于抽象动词都表达不了的意思"></a>对于抽象动词都表达不了的意思</h4><p>这个接口的作用，是通知后端修复完成时间不准确的问题，所以用 &#x2F;signal&#x2F;{notice} 来表达一个信号通知接口的意思</p><blockquote><p>&#x2F;signal&#x2F;fixCompleteTime</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/myvolantis/assets/images/2019-12/31-restful%E9%A3%8E%E6%A0%BC.jpg&quot; class=&quot;lazyload&quot; data-srcset=&quot;/myvolantis/assets/images/201</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="restful" scheme="https://anarckk.github.io/myvolantis/tags/restful/"/>
    
  </entry>
  
  <entry>
    <title>java生成图形验证码（两种图形）</title>
    <link href="https://anarckk.github.io/myvolantis/2019/12/31/2019-12/31-java%E7%94%9F%E6%88%90%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81%EF%BC%88%E4%B8%A4%E7%A7%8D%E5%9B%BE%E5%BD%A2%EF%BC%89/"/>
    <id>https://anarckk.github.io/myvolantis/2019/12/31/2019-12/31-java%E7%94%9F%E6%88%90%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81%EF%BC%88%E4%B8%A4%E7%A7%8D%E5%9B%BE%E5%BD%A2%EF%BC%89/</id>
    <published>2019-12-31T00:45:47.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>来源：<a href="https://blog.csdn.net/iku5200/article/details/91792260">https://blog.csdn.net/iku5200/article/details/91792260</a></p><p><img src="/myvolantis/assets/images/2019-12/31-%E6%96%B9%E5%BC%8F%E4%B8%80.jpg" class="lazyload" data-srcset="/myvolantis/assets/images/2019-12/31-%E6%96%B9%E5%BC%8F%E4%B8%80.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.security.sercritydemo.untils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.awt.RenderingHints;</span><br><span class="line"><span class="keyword">import</span> java.awt.geom.AffineTransform;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerifyCodeUtils</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//使用到Algerian字体，系统里没有的话需要安装字体，字体只显示大写，去掉了1,0,i,o几个容易混淆的字符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VERIFY_CODES</span> <span class="operator">=</span> <span class="string">&quot;23456789ABCDEFGHJKLMNPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用系统默认字符源生成验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateVerifyCode</span><span class="params">(<span class="type">int</span> verifySize)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> generateVerifyCode(verifySize, VERIFY_CODES);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用指定源生成验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sources    验证码字符源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateVerifyCode</span><span class="params">(<span class="type">int</span> verifySize, String sources)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sources == <span class="literal">null</span> || sources.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            sources = VERIFY_CODES;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">codesLen</span> <span class="operator">=</span> sources.length();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(System.currentTimeMillis());</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">verifyCode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(verifySize);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; verifySize; i++) &#123;</span><br><span class="line">            verifyCode.append(sources.charAt(rand.nextInt(codesLen - <span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> verifyCode.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机验证码文件,并返回验证码值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">outputVerifyImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, File outputFile, <span class="type">int</span> verifySize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, outputFile, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出随机验证码图片流,并返回验证码值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">outputVerifyImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, OutputStream os, <span class="type">int</span> verifySize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, os, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成指定验证码图像文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">outputImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, File outputFile, String code)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (outputFile == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> outputFile.getParentFile();</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputFile.createNewFile();</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile);</span><br><span class="line">            outputImage(w, h, fos, code);</span><br><span class="line">            fos.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出指定验证码图片流</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">outputImage</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> h, OutputStream os, String code)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">verifySize</span> <span class="operator">=</span> code.length();</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(w, h, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2</span> <span class="operator">=</span> image.createGraphics();</span><br><span class="line">        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">        Color[] colors = <span class="keyword">new</span> <span class="title class_">Color</span>[<span class="number">5</span>];</span><br><span class="line">        Color[] colorSpaces = <span class="keyword">new</span> <span class="title class_">Color</span>[]&#123;Color.WHITE, Color.CYAN,</span><br><span class="line">                Color.GRAY, Color.LIGHT_GRAY, Color.MAGENTA, Color.ORANGE,</span><br><span class="line">                Color.PINK, Color.YELLOW&#125;;</span><br><span class="line">        <span class="type">float</span>[] fractions = <span class="keyword">new</span> <span class="title class_">float</span>[colors.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; colors.length; i++) &#123;</span><br><span class="line">            colors[i] = colorSpaces[rand.nextInt(colorSpaces.length)];</span><br><span class="line">            fractions[i] = rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(fractions);</span><br><span class="line"> </span><br><span class="line">        g2.setColor(Color.GRAY);<span class="comment">// 设置边框色</span></span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"> </span><br><span class="line">        <span class="type">Color</span> <span class="variable">c</span> <span class="operator">=</span> getRandColor(<span class="number">200</span>, <span class="number">250</span>);</span><br><span class="line">        g2.setColor(c);<span class="comment">// 设置背景色</span></span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">2</span>, w, h - <span class="number">4</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//绘制干扰线</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        g2.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));<span class="comment">// 设置线条的颜色</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(w - <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(h - <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">xl</span> <span class="operator">=</span> random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">yl</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line">            g2.drawLine(x, y, x + xl + <span class="number">40</span>, y + yl + <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 添加噪点</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">yawpRate</span> <span class="operator">=</span> <span class="number">0.05f</span>;<span class="comment">// 噪声率</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">area</span> <span class="operator">=</span> (<span class="type">int</span>) (yawpRate * w * h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; area; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(w);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(h);</span><br><span class="line">            <span class="type">int</span> <span class="variable">rgb</span> <span class="operator">=</span> getRandomIntColor();</span><br><span class="line">            image.setRGB(x, y, rgb);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        shear(g2, w, h, c);<span class="comment">// 使图片扭曲</span></span><br><span class="line"> </span><br><span class="line">        g2.setColor(getRandColor(<span class="number">100</span>, <span class="number">160</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">fontSize</span> <span class="operator">=</span> h - <span class="number">4</span>;</span><br><span class="line">        <span class="type">Font</span> <span class="variable">font</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Algerian&quot;</span>, Font.ITALIC, fontSize);</span><br><span class="line">        g2.setFont(font);</span><br><span class="line">        <span class="type">char</span>[] chars = code.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; verifySize; i++) &#123;</span><br><span class="line">            <span class="type">AffineTransform</span> <span class="variable">affine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AffineTransform</span>();</span><br><span class="line">            affine.setToRotation(Math.PI / <span class="number">4</span> * rand.nextDouble() * (rand.nextBoolean() ? <span class="number">1</span> : -<span class="number">1</span>), (w / verifySize) * i + fontSize / <span class="number">2</span>, h / <span class="number">2</span>);</span><br><span class="line">            g2.setTransform(affine);</span><br><span class="line">            g2.drawChars(chars, i, <span class="number">1</span>, ((w - <span class="number">10</span>) / verifySize) * i + <span class="number">5</span>, h / <span class="number">2</span> + fontSize / <span class="number">2</span> - <span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        g2.dispose();</span><br><span class="line">        ImageIO.write(image, <span class="string">&quot;png&quot;</span>, os);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title function_">getRandColor</span><span class="params">(<span class="type">int</span> fc, <span class="type">int</span> bc)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">            fc = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">            bc = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getRandomIntColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] rgb = getRandomRgb();</span><br><span class="line">        <span class="type">int</span> <span class="variable">color</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> c : rgb) &#123;</span><br><span class="line">            color = color &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            color = color | c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] getRandomRgb() &#123;</span><br><span class="line">        <span class="type">int</span>[] rgb = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            rgb[i] = random.nextInt(<span class="number">255</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rgb;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shear</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line">        shearX(g, w1, h1, color);</span><br><span class="line">        shearY(g, w1, h1, color);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shearX</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> <span class="variable">period</span> <span class="operator">=</span> random.nextInt(<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">borderGap</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">frames</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">phase</span> <span class="operator">=</span> random.nextInt(<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; h1; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> (<span class="type">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="type">double</span>) i / (<span class="type">double</span>) period</span><br><span class="line">                    + (<span class="number">6.2831853071795862D</span> * (<span class="type">double</span>) phase)</span><br><span class="line">                    / (<span class="type">double</span>) frames);</span><br><span class="line">            g.copyArea(<span class="number">0</span>, i, w1, <span class="number">1</span>, (<span class="type">int</span>) d, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine((<span class="type">int</span>) d, i, <span class="number">0</span>, i);</span><br><span class="line">                g.drawLine((<span class="type">int</span>) d + w1, i, w1, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shearY</span><span class="params">(Graphics g, <span class="type">int</span> w1, <span class="type">int</span> h1, Color color)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> <span class="variable">period</span> <span class="operator">=</span> random.nextInt(<span class="number">40</span>) + <span class="number">10</span>; <span class="comment">// 50;</span></span><br><span class="line"> </span><br><span class="line">        <span class="type">boolean</span> <span class="variable">borderGap</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">frames</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">phase</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; w1; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> (<span class="type">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="type">double</span>) i / (<span class="type">double</span>) period</span><br><span class="line">                    + (<span class="number">6.2831853071795862D</span> * (<span class="type">double</span>) phase)</span><br><span class="line">                    / (<span class="type">double</span>) frames);</span><br><span class="line">            g.copyArea(i, <span class="number">0</span>, <span class="number">1</span>, h1, <span class="number">0</span>, (<span class="type">int</span>) d);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine(i, (<span class="type">int</span>) d, i, <span class="number">0</span>);</span><br><span class="line">                g.drawLine(i, (<span class="type">int</span>) d + h1, i, h1);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:/img/&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> <span class="number">200</span>, h = <span class="number">80</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">verifyCode</span> <span class="operator">=</span> generateVerifyCode(<span class="number">4</span>);</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, verifyCode + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            outputImage(w, h, file, verifyCode);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/myvolantis/assets/iamges/2019-12/31-%E6%96%B9%E5%BC%8F%E4%BA%8C.jpg" class="lazyload" data-srcset="/myvolantis/assets/iamges/2019-12/31-%E6%96%B9%E5%BC%8F%E4%BA%8C.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成图形验证码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthImg</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"><span class="comment">// 定义图形验证码中绘制的字符的字体</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Font</span> <span class="variable">mFont</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Arial Black&quot;</span>, Font.PLAIN, <span class="number">23</span>);</span><br><span class="line"><span class="comment">// 图形验证码的大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IMG_WIDTH</span> <span class="operator">=</span> <span class="number">72</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IMG_HEIGTH</span> <span class="operator">=</span> <span class="number">27</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取随机颜色的方法</span></span><br><span class="line"><span class="keyword">private</span> Color <span class="title function_">getRandColor</span><span class="params">(<span class="type">int</span> fc, <span class="type">int</span> bc)</span> &#123;</span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"><span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">fc = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">bc = <span class="number">255</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line"><span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>(r, g, b);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取随机字符串</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getRandomChar</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">rand</span> <span class="operator">=</span> (<span class="type">int</span>) Math.round(Math.random() * <span class="number">2</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">itmp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> <span class="variable">ctmp</span> <span class="operator">=</span> <span class="string">&#x27;\u0000&#x27;</span>;</span><br><span class="line"><span class="keyword">switch</span> (rand) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">itmp = Math.round(Math.random() * <span class="number">25</span> + <span class="number">65</span>);</span><br><span class="line">ctmp = (<span class="type">char</span>) itmp;</span><br><span class="line"><span class="keyword">return</span> String.valueOf(ctmp);</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">itmp = Math.round(Math.random() * <span class="number">25</span> + <span class="number">97</span>);</span><br><span class="line">ctmp = (<span class="type">char</span>) itmp;</span><br><span class="line"><span class="keyword">return</span> String.valueOf(ctmp);</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">itmp = Math.round(Math.random() * <span class="number">9</span>);</span><br><span class="line"><span class="keyword">return</span> itmp + <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="comment">// 设置禁止缓存</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;No-cache&quot;</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">response.setDateHeader(<span class="string">&quot;Expires&quot;</span>, <span class="number">0</span>);</span><br><span class="line">response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"><span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(IMG_WIDTH, IMG_HEIGTH, BufferedImage.TYPE_INT_RGB);</span><br><span class="line"><span class="type">Graphics</span> <span class="variable">g</span> <span class="operator">=</span> image.getGraphics();</span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line"><span class="comment">// 填充背景色</span></span><br><span class="line">g.fillRect(<span class="number">1</span>, <span class="number">1</span>, IMG_WIDTH - <span class="number">1</span>, IMG_HEIGTH - <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 为图形验证码绘制边框</span></span><br><span class="line">g.setColor(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">102</span>, <span class="number">102</span>, <span class="number">102</span>));</span><br><span class="line">g.drawRect(<span class="number">0</span>, <span class="number">0</span>, IMG_WIDTH, IMG_HEIGTH);</span><br><span class="line">g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line"><span class="comment">// 生成随机干扰线</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">80</span>; i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(IMG_WIDTH - <span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(IMG_HEIGTH - <span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">y1</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line">g.drawLine(x, y, x + x1, y + y1);</span><br><span class="line">&#125;</span><br><span class="line">g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line"><span class="comment">// 生成随机干扰线</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">80</span>; i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(IMG_WIDTH - <span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(IMG_HEIGTH - <span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">y1</span> <span class="operator">=</span> random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line">g.drawLine(x, y, x - x1, y - y1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置绘制字符的字体</span></span><br><span class="line">g.setFont(mFont);</span><br><span class="line"><span class="comment">// 用于保存系统生成的随机字符串</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sRand</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">tmp</span> <span class="operator">=</span> getRandomChar();</span><br><span class="line">sRand += tmp;</span><br><span class="line">g.setColor(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">g.drawString(tmp, <span class="number">15</span> * i + <span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取HttpSession对象</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession(<span class="literal">true</span>);</span><br><span class="line">session.removeAttribute(<span class="string">&quot;rand&quot;</span>);</span><br><span class="line">session.setAttribute(<span class="string">&quot;rand&quot;</span>, sRand);</span><br><span class="line">g.dispose();</span><br><span class="line"><span class="comment">// 向输出流中输出图片</span></span><br><span class="line">ImageIO.write(image, <span class="string">&quot;JPEG&quot;</span>, response.getOutputStream());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;来源：&lt;a href=&quot;https://blog.csdn.net/iku5200/article/details/91792260&quot;&gt;https://blog.csdn.net/iku5200/article/details/91792260&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;im</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>在非SpringBean类中从ApplicationContext取出Bean</title>
    <link href="https://anarckk.github.io/myvolantis/2019/12/31/2019-12/31-%E5%9C%A8%E9%9D%9ESpringBean%E7%B1%BB%E4%B8%AD%E4%BB%8EApplicationContext%E5%8F%96%E5%87%BABean/"/>
    <id>https://anarckk.github.io/myvolantis/2019/12/31/2019-12/31-%E5%9C%A8%E9%9D%9ESpringBean%E7%B1%BB%E4%B8%AD%E4%BB%8EApplicationContext%E5%8F%96%E5%87%BABean/</id>
    <published>2019-12-31T00:40:24.000Z</published>
    <updated>2023-06-19T08:37:14.691Z</updated>
    
    <content type="html"><![CDATA[<p>本文的主要目的是从spring中取出bean，然后赋值给一个util类，util是静态工具类，不用放到spring注册到bean。所以它也拿不到spring bean。为了让util单方面的拿到bean，可以这么做</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringContextHolder</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现ApplicationContextAware接口的context注入函数, 将其存入静态变量.</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> &#123;</span><br><span class="line">SpringContextHolder.applicationContext = applicationContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得存储在静态变量中的ApplicationContext.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title function_">getApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">checkApplicationContext();</span><br><span class="line"><span class="keyword">return</span> applicationContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从静态变量ApplicationContext中取得Bean, 自动转型为所赋值对象的类型.</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String name)</span> &#123;</span><br><span class="line">checkApplicationContext();</span><br><span class="line"><span class="keyword">return</span> (T) applicationContext.getBean(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从静态变量ApplicationContext中取得Bean, 自动转型为所赋值对象的类型.</span></span><br><span class="line"><span class="comment">// 从静态变量ApplicationContext中取得Bean, 自动转型为所赋值对象的类型.</span></span><br><span class="line"><span class="comment">// 如果有多个Bean符合Class, 取出第一个.</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">checkApplicationContext();</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="type">Map</span> <span class="variable">beanMaps</span> <span class="operator">=</span> applicationContext.getBeansOfType(clazz);</span><br><span class="line"><span class="keyword">if</span> (beanMaps != <span class="literal">null</span> &amp;&amp; !beanMaps.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">return</span> (T) beanMaps.values().iterator().next();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (applicationContext == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;applicaitonContext未注入,请在applicationContext.xml中定义SpringContextHolder&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过一个中介bean，在其他util中，就可以使用这个中介bean取出spring上下文中的bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; REDIS_TEMPLATE = SpringContextHolder</span><br><span class="line">        .getBean(RedisTemplate.class);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文的主要目的是从spring中取出bean，然后赋值给一个util类，util是静态工具类，不用放到spring注册到bean。所以它也拿不到spring bean。为了让util单方面的拿到bean，可以这么做&lt;/p&gt;
&lt;figure class=&quot;highlight </summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="JAVA" scheme="https://anarckk.github.io/myvolantis/tags/JAVA/"/>
    
    <category term="springframework" scheme="https://anarckk.github.io/myvolantis/tags/springframework/"/>
    
  </entry>
  
  <entry>
    <title>shiro中的SimpleAuthenticationInfo</title>
    <link href="https://anarckk.github.io/myvolantis/2019/12/30/%E5%BD%92%E6%A1%A3/shiro/30-shiro%E4%B8%AD%E7%9A%84SimpleAuthenticationInfo/"/>
    <id>https://anarckk.github.io/myvolantis/2019/12/30/%E5%BD%92%E6%A1%A3/shiro/30-shiro%E4%B8%AD%E7%9A%84SimpleAuthenticationInfo/</id>
    <published>2019-12-30T07:18:23.000Z</published>
    <updated>2023-06-19T08:37:14.701Z</updated>
    
    <content type="html"><![CDATA[<p>在SimpleAuthenticationInfo构造函数中，第一个参数是principal,第二个参数是credencials，第三个参数可选，是用于哈希的盐的值，第四个是realm名字。</p><p>doGetAuthenticationInfo(AuthenticationToken token)得到AuthticationInfo之后，会自定对比里面的credencitals和subject.login时候传入的credentials是否匹配。匹配就通过，不匹配就会报IncorrectCredentialsException。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证</span></span><br><span class="line"><span class="comment">     * 这一步我们根据token给的用户名，去数据库查出加密过用户密码，然后把加密后的密码和盐值一起发给shiro，让它做比对</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">userpasswordToken</span> <span class="operator">=</span> (UsernamePasswordToken) token;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> userpasswordToken.getUsername();</span><br><span class="line">        <span class="type">UserDto</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserInfo(username);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(<span class="string">&quot;用户不存在！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(user, user.getEncryptPwd(), <span class="string">&quot;dbRealm&quot;</span>);</span><br><span class="line"><span class="comment">//        return new SimpleAuthenticationInfo(user, user.getEncryptPwd(), ByteSource.Util.bytes(encryptSalt), &quot;dbRealm&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> &#123;</span><br><span class="line">        <span class="comment">//返回实体</span></span><br><span class="line">        <span class="type">SimpleAuthorizationInfo</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>();</span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        roles.add(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        result.setRoles(roles);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>如果要用上哈希盐对比密码，应该在该自定义realm构造函数里增加setCredentialsMatcher。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DbShiroRealm</span><span class="params">(IUserService userService)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    <span class="comment">//因为数据库中的密码做了散列，所以使用shiro的散列Matcher</span></span><br><span class="line">    <span class="built_in">this</span>.setCredentialsMatcher(<span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>(Sha256Hash.ALGORITHM_NAME));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在SimpleAuthenticationInfo构造函数中，第一个参数是principal,第二个参数是credencials，第三个参数可选，是用于哈希的盐的值，第四个是realm名字。&lt;/p&gt;
&lt;p&gt;doGetAuthenticationInfo(Authentica</summary>
      
    
    
    
    <category term="上层技术" scheme="https://anarckk.github.io/myvolantis/categories/%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="shiro" scheme="https://anarckk.github.io/myvolantis/tags/shiro/"/>
    
  </entry>
  
</feed>
